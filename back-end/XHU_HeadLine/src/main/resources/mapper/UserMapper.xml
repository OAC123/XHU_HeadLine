<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xhu.headline_server.mapper.UserMapper">

    <!-- 根据 id 查询用户 -->
    <select id="getUserById" parameterType="long" resultType="com.xhu.headline_server.entity.User">
        SELECT
            id,
            user_name    AS userName,
            password,
            nick_name    AS nickName,
            avatar_url   AS avatarUrl,
            phone,
            role,
            create_time  AS createTime,
            update_time  AS updateTime,
            deleted
        FROM `user`
        WHERE id = #{id}
          AND deleted = 0
    </select>

    <select id="getByUserName" parameterType="string" resultType="com.xhu.headline_server.entity.User">
        SELECT * FROM user WHERE user_name = #{userName} LIMIT 1
    </select>

    <!-- 新增用户 -->
    <insert id="addUser" parameterType="com.xhu.headline_server.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `user` (
            user_name,
            password,
            nick_name,
            avatar_url,
            phone,
            role,
            create_time,
            update_time,
            deleted
        ) VALUES (
                     #{userName},
                     #{password},
                     #{nickName},
                     #{avatarUrl},
                     #{phone},
                     #{role},
                     NOW(),
                     NOW(),
                     0
                 )
    </insert>

    <!-- 更新用户 -->
    <update id="updateUser" parameterType="com.xhu.headline_server.entity.User">
        UPDATE `user`
        SET
            user_name   = #{userName},
            password    = #{password},
            nick_name   = #{nickName},
            avatar_url  = #{avatarUrl},
            phone       = #{phone},
            role        = #{role},
            update_time = NOW()
        WHERE id = #{id}
          AND deleted = 0
    </update>

    <!-- 根据 id 删除用户 -->
    <delete id="delUserById" parameterType="long">
        DELETE FROM `user`
        WHERE id = #{id}
    </delete>

    <!-- 查询所有未删除的用户 -->
    <select id="getAllUsers" resultType="com.xhu.headline_server.entity.User">
        SELECT
            id,
            user_name    AS userName,
            password,
            nick_name    AS nickName,
            avatar_url   AS avatarUrl,
            phone,
            role,
            create_time  AS createTime,
            update_time  AS updateTime,
            deleted
        FROM `user`
        WHERE deleted = 0
        ORDER BY id DESC
    </select>

    <!-- 根据用户名和密码查询用户，给 selectNameAndPassword 使用 -->
    <select id="selectNameAndPassword"
            parameterType="map"
            resultType="com.xhu.headline_server.entity.User">
        SELECT
            id,
            user_name   AS userName,
            password,
            nick_name   AS nickName,
            avatar_url  AS avatarUrl,
            phone,
            role,
            create_time AS createTime,
            update_time AS updateTime,
            deleted
        FROM `user`
        WHERE user_name = #{username}
          AND password  = #{password}
          AND deleted   = 0
            LIMIT 1
    </select>
</mapper>
